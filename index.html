<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBMAOMAO-æ»‘åŠ¨æ‹¼å›¾éªŒè¯ç </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .captcha-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 400px;
            max-width: 100%;
        }

        .captcha-header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .puzzle-container {
            position: relative;
            width: 100%;
            height: 240px;
            background: #f8f9fa;
            overflow: hidden;
        }

        .puzzle-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .puzzle-piece {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .puzzle-hole {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px dashed #fff;
            z-index: 5;
        }

        .slider-container {
            padding: 20px;
            background: #f8f9fa;
        }

        .slider-track {
            position: relative;
            width: 100%;
            height: 50px;
            background: #e9ecef;
            border-radius: 25px;
            overflow: hidden;
            cursor: pointer;
        }

        .slider-bg {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 25px;
        }

        .slider-button {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 44px;
            height: 44px;
            background: white;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .slider-button:active {
            cursor: grabbing;
            transform: scale(1.1);
        }

        .slider-button::after {
            content: "â†’";
            font-size: 18px;
            color: #666;
            font-weight: bold;
        }

        .slider-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 14px;
            pointer-events: none;
            z-index: 5;
        }

        .controls {
            padding: 20px;
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-verify {
            background: #4CAF50;
            color: white;
        }

        .btn-verify:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-refresh {
            background: #2196F3;
            color: white;
        }

        .btn-refresh:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .status-message {
            padding: 15px 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes success {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .success {
            animation: success 0.6s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="captcha-container">
        <div class="captcha-header">
            ğŸ§© æ»‘åŠ¨æ‹¼å›¾éªŒè¯
        </div>
        
        <div class="puzzle-container" id="puzzleContainer">
            <img class="puzzle-bg" id="puzzleBg" src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=240&fit=crop" alt="æ‹¼å›¾èƒŒæ™¯">
            <div class="puzzle-hole" id="puzzleHole"></div>
            <div class="puzzle-piece" id="puzzlePiece"></div>
        </div>
        
        <div class="slider-container">
            <div class="slider-track" id="sliderTrack">
                <div class="slider-bg" id="sliderBg"></div>
                <div class="slider-button" id="sliderButton"></div>
                <div class="slider-text" id="sliderText">å‘å³æ‹–åŠ¨æ»‘å—å®Œæˆæ‹¼å›¾</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-verify" id="verifyBtn">è¯·ç‚¹å‡»éªŒè¯</button>
            <button class="btn btn-refresh" id="refreshBtn">åˆ·æ–°</button>
        </div>
        
        <div class="status-message" id="statusMessage"></div>
    </div>

    <script>
        class SlidePuzzle {
            constructor() {
                this.initElements();
                this.initVariables();
                this.initEvents();
                this.generatePuzzle();
            }

            initElements() {
                this.container = document.getElementById('puzzleContainer');
                this.puzzleBg = document.getElementById('puzzleBg');
                this.puzzleHole = document.getElementById('puzzleHole');
                this.puzzlePiece = document.getElementById('puzzlePiece');
                this.sliderTrack = document.getElementById('sliderTrack');
                this.sliderBg = document.getElementById('sliderBg');
                this.sliderButton = document.getElementById('sliderButton');
                this.sliderText = document.getElementById('sliderText');
                this.verifyBtn = document.getElementById('verifyBtn');
                this.refreshBtn = document.getElementById('refreshBtn');
                this.statusMessage = document.getElementById('statusMessage');
            }

            initVariables() {
                this.isDragging = false;
                this.startX = 0;
                this.currentX = 0;
                this.maxSlideDistance = 0;
                this.tolerance = 10;
                this.isCompleted = false;
                this.holeX = 0;
                this.pieceX = 0;
            }

            initEvents() {
                // é¼ æ ‡äº‹ä»¶
                this.sliderButton.addEventListener('mousedown', this.handleStart.bind(this));
                document.addEventListener('mousemove', this.handleMove.bind(this));
                document.addEventListener('mouseup', this.handleEnd.bind(this));

                // è§¦æ‘¸äº‹ä»¶
                this.sliderButton.addEventListener('touchstart', this.handleStart.bind(this));
                document.addEventListener('touchmove', this.handleMove.bind(this));
                document.addEventListener('touchend', this.handleEnd.bind(this));

                // æŒ‰é’®äº‹ä»¶
                this.verifyBtn.addEventListener('click', this.verify.bind(this));
                this.refreshBtn.addEventListener('click', this.refresh.bind(this));

                // å›¾ç‰‡åŠ è½½äº‹ä»¶
                this.puzzleBg.addEventListener('load', this.onImageLoad.bind(this));
            }

            generatePuzzle() {
                // éšæœºç”Ÿæˆç¼ºå£ä½ç½®
                const containerWidth = this.container.offsetWidth;
                const containerHeight = this.container.offsetHeight;
                const pieceWidth = 60;
                const pieceHeight = 60;

                // ç¡®ä¿ç¼ºå£ä¸ä¼šå¤ªé è¿‘è¾¹ç¼˜
                const minX = pieceWidth + 50;
                const maxX = containerWidth - pieceWidth - 50;
                const minY = 20;
                const maxY = containerHeight - pieceHeight - 20;

                this.holeX = Math.random() * (maxX - minX) + minX;
                const holeY = Math.random() * (maxY - minY) + minY;

                // è®¾ç½®ç¼ºå£ä½ç½®
                this.puzzleHole.style.left = this.holeX + 'px';
                this.puzzleHole.style.top = holeY + 'px';

                // è®¾ç½®æ‹¼å›¾å—åˆå§‹ä½ç½®ï¼ˆå·¦ä¾§ï¼‰
                this.pieceX = 10;
                this.puzzlePiece.style.left = this.pieceX + 'px';
                this.puzzlePiece.style.top = holeY + 'px';

                // è®¡ç®—æœ€å¤§æ»‘åŠ¨è·ç¦»å’Œæ‹¼å›¾ç§»åŠ¨è·ç¦»
                this.maxSlideDistance = this.sliderTrack.offsetWidth - this.sliderButton.offsetWidth;
                this.maxPieceDistance = this.holeX - this.pieceX;

                // é‡ç½®çŠ¶æ€
                this.resetSlider();
                this.hideStatus();
            }

            onImageLoad() {
                // å›¾ç‰‡åŠ è½½å®Œæˆåæ›´æ–°æ‹¼å›¾å—èƒŒæ™¯
                this.updatePieceBackground();
            }

            updatePieceBackground() {
                const rect = this.puzzleBg.getBoundingClientRect();
                const containerRect = this.container.getBoundingClientRect();
                
                // è®¡ç®—æ‹¼å›¾å—ç›¸å¯¹äºå›¾ç‰‡çš„ä½ç½®
                const pieceRect = this.puzzlePiece.getBoundingClientRect();
                const relativeX = pieceRect.left - containerRect.left;
                const relativeY = pieceRect.top - containerRect.top;

                // è®¾ç½®æ‹¼å›¾å—çš„èƒŒæ™¯å›¾ç‰‡
                this.puzzlePiece.style.backgroundImage = `url(${this.puzzleBg.src})`;
                this.puzzlePiece.style.backgroundSize = `${rect.width}px ${rect.height}px`;
                this.puzzlePiece.style.backgroundPosition = `-${this.holeX}px -${relativeY}px`;
                this.puzzlePiece.style.backgroundRepeat = 'no-repeat';
            }

            handleStart(e) {
                if (this.isCompleted) return;

                this.isDragging = true;
                this.startX = this.getEventX(e);
                this.sliderButton.style.transition = 'none';
                this.sliderBg.style.transition = 'none';
                this.puzzlePiece.style.transition = 'none';
                
                e.preventDefault();
            }

            handleMove(e) {
                if (!this.isDragging || this.isCompleted) return;

                const currentX = this.getEventX(e);
                const deltaX = currentX - this.startX;
                
                // å…è®¸æ»‘å—åœ¨æ•´ä¸ªæ»‘é“èŒƒå›´å†…ç§»åŠ¨
                const newX = Math.max(0, Math.min(deltaX, this.maxSlideDistance));

                // æ›´æ–°æ»‘å—ä½ç½®
                this.sliderButton.style.left = (newX + 3) + 'px';
                this.sliderBg.style.width = ((newX / this.maxSlideDistance) * 100) + '%';

                // æ›´æ–°æ‹¼å›¾å—ä½ç½® - æ‹¼å›¾å—ç§»åŠ¨è·ç¦»ä¸æ»‘å—æˆæ¯”ä¾‹ï¼Œä½†å¯ä»¥è¶…è¿‡æŒ–ç©ºä½ç½®
                const progress = newX / this.maxSlideDistance;
                const maxPieceMovement = this.container.offsetWidth - this.pieceX - 60; // å®¹å™¨å®½åº¦å‡å»æ‹¼å›¾å—å®½åº¦
                const pieceCurrentX = this.pieceX + (progress * maxPieceMovement);
                this.puzzlePiece.style.left = pieceCurrentX + 'px';

                this.currentX = newX;

                e.preventDefault();
            }

            handleEnd(e) {
                if (!this.isDragging) return;

                this.isDragging = false;
                this.sliderButton.style.transition = 'all 0.3s ease';
                this.sliderBg.style.transition = 'width 0.3s ease';
                this.puzzlePiece.style.transition = 'all 0.3s ease';

                // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‹¼å›¾
                this.checkCompletion();
            }

            getEventX(e) {
                return e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            }

            checkCompletion() {
                // è®¡ç®—æ‹¼å›¾å—å½“å‰ä½ç½®
                const progress = this.currentX / this.maxSlideDistance;
                const maxPieceMovement = this.container.offsetWidth - this.pieceX - 60;
                const pieceCurrentX = this.pieceX + (progress * maxPieceMovement);
                const distance = Math.abs(pieceCurrentX - this.holeX);

                if (distance <= this.tolerance) {
                    this.complete();
                } else {
                    this.reset();
                }
            }

            complete() {
                this.isCompleted = true;
                
                // ç²¾ç¡®å¯¹é½ - æ‹¼å›¾å—å¯¹é½åˆ°ç¼ºå£ä½ç½®
                this.puzzlePiece.style.left = this.holeX + 'px';
                
                // æ»‘å—å¯¹é½åˆ°å¯¹åº”ä½ç½® - è®¡ç®—æ­£ç¡®çš„æ»‘å—ä½ç½®
                const maxPieceMovement = this.container.offsetWidth - this.pieceX - 60;
                const requiredProgress = (this.holeX - this.pieceX) / maxPieceMovement;
                const correctSliderPosition = requiredProgress * this.maxSlideDistance;
                this.sliderButton.style.left = (correctSliderPosition + 3) + 'px';
                this.sliderBg.style.width = (requiredProgress * 100) + '%';
                this.sliderBg.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                
                // æ›´æ–°æ–‡æœ¬å’ŒæŒ‰é’®
                this.sliderText.textContent = 'éªŒè¯æˆåŠŸï¼';
                this.sliderText.style.color = '#FFFFFF';
                this.sliderText.style.left = '10px'; // æ–‡å­—æ˜¾ç¤ºåœ¨ç»¿è‰²åŒºåŸŸå·¦ä¾§
                this.sliderText.style.transform = 'translateY(-50%)'; // åªä¿æŒå‚ç›´å±…ä¸­
                this.sliderText.style.textAlign = 'left';
                this.sliderButton.style.background = '#4CAF50';
                this.sliderButton.innerHTML = 'âœ“';
                
                // æ˜¾ç¤ºæˆåŠŸåŠ¨ç”»
                this.container.classList.add('success');
                setTimeout(() => {
                    this.container.classList.remove('success');
                }, 600);

                this.showStatus('éªŒè¯æˆåŠŸï¼æ‹¼å›¾å®Œæˆï¼', 'success');
            }

            reset() {
                // éœ‡åŠ¨æ•ˆæœ
                this.container.classList.add('shake');
                setTimeout(() => {
                    this.container.classList.remove('shake');
                }, 500);

                // é‡ç½®ä½ç½®
                setTimeout(() => {
                    this.resetSlider();
                }, 300);

                this.showStatus('ä½ç½®ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•', 'error');
            }

            resetSlider() {
                this.currentX = 0;
                this.sliderButton.style.left = '3px';
                this.sliderBg.style.width = '0%';
                this.sliderBg.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                this.puzzlePiece.style.left = this.pieceX + 'px';
                this.sliderText.textContent = 'å‘å³æ‹–åŠ¨æ»‘å—å®Œæˆæ‹¼å›¾';
                this.sliderText.style.color = '#666';
                this.sliderText.style.left = '50%'; // é‡ç½®ä¸ºå±…ä¸­
                this.sliderText.style.transform = 'translate(-50%, -50%)'; // é‡ç½®ä¸ºå®Œå…¨å±…ä¸­
                this.sliderText.style.textAlign = 'center';
                this.sliderButton.style.background = 'white';
                this.sliderButton.innerHTML = '';
                this.isCompleted = false;
            }

            verify() {
                if (this.isCompleted) {
                    this.showStatus('éªŒè¯é€šè¿‡ï¼', 'success');
                    window.location.href = 'in.html';
                } else {
                    this.showStatus('è¯·å…ˆå®Œæˆæ‹¼å›¾éªŒè¯', 'error');
                }
            }

            refresh() {
                // æ·»åŠ åŠ è½½æ•ˆæœ
                this.container.classList.add('loading');
                
                // ä½¿ç”¨Unsplashçš„ä¸åŒå›¾ç‰‡ - é¢„å®šä¹‰çš„å¯ç”¨å›¾ç‰‡IDåˆ—è¡¨
                const imageIds = [
                    '1506905925346-21bda4d32df4',  // å±±æ™¯
                    '1519834785169-98be25ec3f84',  // è‡ªç„¶é£æ™¯
                    '1506260408121-e353d10b87c7',  // æµ·æ™¯
                    '1519834785169-98be25ec3f84',  // æ£®æ—
                    '1506905925346-21bda4d32df4',  // å±±å³°
                    '1519834785169-98be25ec3f84'   // æ¹–æ³Š
                ];
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå›¾ç‰‡ID
                const randomIndex = Math.floor(Math.random() * imageIds.length);
                const selectedImageId = imageIds[randomIndex];
                
                // ç”Ÿæˆæ–°çš„å›¾ç‰‡URL
                this.puzzleBg.src = `https://images.unsplash.com/photo-${selectedImageId}?w=400&h=240&fit=crop&t=${Date.now()}`;
                
                // ç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå†ç”Ÿæˆæ‹¼å›¾
                this.puzzleBg.onload = () => {
                    this.generatePuzzle();
                    this.container.classList.remove('loading');
                };
                
                // å¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥çš„æƒ…å†µ
                this.puzzleBg.onerror = () => {
                    console.log('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œé‡æ–°ç”Ÿæˆæ‹¼å›¾');
                    this.generatePuzzle();
                    this.container.classList.remove('loading');
                };
            }

            showStatus(message, type) {
                this.statusMessage.textContent = message;
                this.statusMessage.className = `status-message status-${type}`;
                this.statusMessage.style.display = 'block';

                setTimeout(() => {
                    this.hideStatus();
                }, 3000);
            }

            hideStatus() {
                this.statusMessage.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–æ‹¼å›¾éªŒè¯ç 
        document.addEventListener('DOMContentLoaded', () => {
            new SlidePuzzle();
        });
    </script>
</body>
</html>
